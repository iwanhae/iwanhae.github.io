<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="구 블로그에서 가져옴"><title>라즈베리파이에서 FFMPEG로 인코딩 하기</title><link rel=canonical href=https://iwanhae.github.io/p/pi-ffmpeg/><link rel=stylesheet href=/scss/style.min.css><meta name=google-site-verification content="hueaQ_HMu3Eq1ONg2Nh47uVN-tQXPzXlh1DXig6eT7c"><meta property="og:title" content="라즈베리파이에서 FFMPEG로 인코딩 하기"><meta property="og:description" content="구 블로그에서 가져옴"><meta property="og:url" content="https://iwanhae.github.io/p/pi-ffmpeg/"><meta property="og:site_name" content="iWan"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:published_time" content="2016-01-09T00:00:00+00:00"><meta property="article:modified_time" content="2016-01-09T00:00:00+00:00"><meta property="og:image" content="https://iwanhae.github.io/p/pi-ffmpeg/encode.png"><meta name=twitter:title content="라즈베리파이에서 FFMPEG로 인코딩 하기"><meta name=twitter:description content="구 블로그에서 가져옴"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://iwanhae.github.io/p/pi-ffmpeg/encode.png"></head><body><div class="container flex on-phone--column align-items--flex-start extended article-page with-toolbar"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hub2a4b6b69d3b0618960cb9af6c0975e0_643282_300x300_resize_box_2.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>😎️</span></figure><h1 class=site-name><a href=https://iwanhae.github.io>iWan</a></h1><h2 class=site-description>#include "Hi.h"</h2></header><ol class=menu id=main-menu><li><a href=https://iwanhae.github.io/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=https://iwanhae.github.io/welcome-to-iwan><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About (kr)</span></a></li><li><a href=https://iwanhae.github.io/wanhae-lee><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About (en)</span></a></li><li><a href=https://iwanhae.github.io/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li></ol></aside><main class="main full-width"><div id=article-toolbar><a href=https://iwanhae.github.io class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><article class="has-image main-article"><header class=article-header><div class=article-image><img srcset="/p/pi-ffmpeg/encode_hu913b542a516d2baf069c790547ae587a_30859_1024x0_resize_box_2.png 1024w, /p/pi-ffmpeg/encode_hu913b542a516d2baf069c790547ae587a_30859_2000x0_resize_box_2.png 2000w" src=/p/pi-ffmpeg/encode_hu913b542a516d2baf069c790547ae587a_30859_2000x0_resize_box_2.png width=661 height=418 loading=lazy alt="Featured image of post 라즈베리파이에서 FFMPEG로 인코딩 하기"></div><div class=article-details><header class=article-category><a href=https://iwanhae.github.io/categories/server/ class=color-tag data-image=/p/pi-ffmpeg/encode_hu913b542a516d2baf069c790547ae587a_30859_20x20_fill_box_smart1_2.png data-key=pi-ffmpeg data-hash="md5-li0pTxhv7BI/Inhn0m2GSA==">Server</a></header><h2 class=article-title><a href=https://iwanhae.github.io/p/pi-ffmpeg/>라즈베리파이에서 FFMPEG로 인코딩 하기</a></h2><h3 class=article-subtitle>구 블로그에서 가져옴</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>2016년 01월 09일</time></footer></div></header><section class=article-content><h2 id=서론>서론</h2><p>현재 본인은 이 블로그서버를 운영하며 친구들, 지인끼리 동영상공유로도 사용하고 있다. 문제가 있다면 코덱이 워낙 다양한탓에 HTML5로 재생이 안되던가 스마트폰으로 스트리밍으로 재생하기에는 너무 무거운 동영상들이 있다는 것이다. 보통은 해당영상을 다른버전으로 다운받아 해결하지만 그게 힘들경우 따로 인코딩을 하는데 지금부터 라즈베리파이에서 인코딩을 하는법을 소개하겠다.</p><p>하는것은 자유지만 미리 말해두자면 라즈베리 파이의 성능이 성능인만큼 꽤 느리다. 보통 0.12배속으로 인코딩이 진행되는데 24분짜리 영상 인코딩하는데 3~4시간정도 걸린다. (참고로 오드로이드 XU4의 경우 1.1배속정도 나온다.)<del>(단점은 쿨러소리가 상당하다는점)</del></p><h2 id=준비물>준비물</h2><p>보통 대부분은 있지만 일부 배포판의경우 배포 용량을 줄이기위해 자주 빠지는 패키지들을 설치해주자. 설치가 되있다면 그냥 넘어가니 그냥 다음 명령어를 입력하자.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>apt-get install git build-essential
</code></pre></div><h2 id=ffmpeg설치하기>FFMPEG설치하기</h2><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> /usr/src
git clone git://git.videolan.org/x264
<span class=nb>cd</span> x264
./configure --host<span class=o>=</span>arm-unknown-linux-gnueabi --enable-static
make -j4
sudo make install

<span class=nb>cd</span> /usr/src
git clone git://source.ffmpeg.org/ffmpeg.git
<span class=nb>cd</span> ffmpeg
sudo ./configure --arch<span class=o>=</span>armel --target-os<span class=o>=</span>linux --enable-gpl --enable-libx264 --enable-nonfree
make -j4
sudo make install
</code></pre></div><p>다음을 스크립트**(.sh파일)**로 만들어서 루트권한으로 실행시켜주자. 전반부는 가장 많은 기기가 지원하는 H264코덱관련 라이브러리를 설치하는부분이고 후반은 ffmpeg를 설치하는 부분이다.</p><p><a class=link href=./install-ffmpeg.sh>여기</a>서 완성된 파일을 다운받을수도 있다.</p><p>시간이 꽤 걸린다. 켜놓고 딴짓하기 좋은 상황에서 실행하기를 권장한다.</p><blockquote><p>오드로이드 XU4의경우 OpenCL(GPU가속)이 지원된다. 아직 인코딩에서 되는건 아니지만 후반부 <code>./configure</code>할때 <code>--enable-opencl</code>옵션을 추가해주자.</p></blockquote><h2 id=인코딩하기>인코딩하기</h2><p>인코딩방법은 간단하다.
<code>ffmpeg -i [입력파일] -vcodec libx264 [출력파일]</code>
아니면
<code>ffmpeg -i [입력파일] -s 1280x720 -vcodec libx264 [출력파일]</code>
과 같이해서 화면크기를 다르게 하던가
<code>ffmpeg -i [입력파일] -s 1280x720 -threads 1 -vcodec libx264 [출력파일]</code>
과 같이해서 단일스레드로 인코딩을 진행시킬수도 있다.</p><p>옵션은 여러가지가 있으며 각자 자신이 원하는 설정에 맞춰 진행하도록 하자.
일반적으로 이정도 설정이면 핸드폰이나 웹브라우저에서 감상하는데 지장은 없다. (오디오쪽은 불확실)</p><h2 id=덤>덤</h2><p>심슨이나 영드같은 하나의 세트로 구성되있는 영상의경우 이 명령어는 한번에 하나씩밖에 못하며 그나마도 한번 입력하면 최소 4시간뒤에 다시 입력해줘야한다&mldr;.. <del>(수면중 인코딩은 꿈건너 얘기)</del></p><p>그런분들을 위해 간단한 스크립트를 소개한다.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>mkdir bak
mkdir tmp
<span class=k>for</span> i in *.avi<span class=p>;</span> <span class=k>do</span>
 <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$i</span><span class=s2>&#34;</span>
 ffmpeg -i <span class=s2>&#34;</span><span class=nv>$i</span><span class=s2>&#34;</span> -vcodec libx264 <span class=s2>&#34;./tmp/</span><span class=nv>$i</span><span class=s2>&#34;</span>
 mv <span class=s2>&#34;</span><span class=nv>$i</span><span class=s2>&#34;</span> <span class=s2>&#34;./bak/</span><span class=nv>$i</span><span class=s2>&#34;</span>
 mv <span class=s2>&#34;./tmp/</span><span class=nv>$i</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$i</span><span class=s2>&#34;</span>
<span class=k>done</span>
</code></pre></div><p>이 스크립트를 소개하자면 이 sh파일을 실행시킨 경로에서 모든 avi파일을 찾아낸뒤 tmp폴더에 인코딩 결과물을 생성하고 인코딩이 완료됬을때 기존파일은 bak폴더로, 인코딩된 파일을 원래위치로 옮겨주는 스크립트이다. 각자 상황에 맞게 수정해서 사용하자.</p><blockquote><p>사용예시</p><p><img src=./encode.png alt></p><p><code>encode.sh</code>위 스크립트내용이 그대로 들어가있는 파일이다. 영상이 있는 장소에서 다음과 같이 명령어를 사용하면된다.</p></blockquote><h2 id=덤2>덤2</h2><p>참고로 본인은 이렇게 사용하고 있다.
<img src=./---_20160103_110403_LLS.jpg alt></p><p>사람없을때는 ODROID XU4가 엄청나게 시끄러운 소음을 내며 인코딩 사람 있을때는 RASPBERRYPI2에 전원을 공급하고 NFS로 ODROID XU4의 영상파일에 접근해 영상 인코딩.</p></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload="renderMathInElement(document.querySelector(`.article-content`));"></script></article><aside class="widget related-contents--wrapper"><h1 class=widget-title></h1><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=https://iwanhae.github.io/p/disabling_uas_on_linux/><div class=article-image><img src=/p/disabling_uas_on_linux/5700219_2_hud52212587ef5e2c8c5bb794242b75122_10725_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy data-key=disabling_uas_on_linux data-hash="md5-r4H8r7HtiIGX0oIWzgDLPw=="></div><div class=article-details><h2 class=article-title>Odroid N2, Linux에서 UAS 비활성화</h2></div></a></article><article class=has-image><a href=https://iwanhae.github.io/p/config-netplan-bridge/><div class=article-image><img src=/p/config-netplan-bridge/netplan_hu64e3fbf4fa724c9fadaeb8a9cb4d85df_56060_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key=config-netplan-bridge data-hash="md5-ABxmSxxb4eJwr+EYPCBD0w=="></div><div class=article-details><h2 class=article-title>Netplan Bridge 구성기</h2></div></a></article><article class=has-image><a href=https://iwanhae.github.io/p/renewing_freenom_domain/><div class=article-image><img src=/p/renewing_freenom_domain/1_hu4676b6a3ff35eaeac3cf791939cc3722_949805_250x150_fill_box_smart1_2.PNG width=250 height=150 loading=lazy data-key=renewing_freenom_domain data-hash="md5-7ZxOVLCu21fJCBAM/o/Q0w=="></div><div class=article-details><h2 class=article-title>Freenom 도메인 갱신하는법</h2></div></a></article><article class=has-image><a href=https://iwanhae.github.io/p/saga_of_wanhae_the_googler/><div class=article-image><img src=/p/saga_of_wanhae_the_googler/1_hu41572d6144ff73f80dd14306a597fd99_32390_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key=saga_of_wanhae_the_googler data-hash="md5-TQ+TXrYq1o9bVX2sdT4MyA=="></div><div class=article-details><h2 class=article-title>사이버 지식 정보방 (사지방) 구글 접속기</h2></div></a></article><article class=has-image><a href=https://iwanhae.github.io/p/shellinabox/><div class=article-image><img src=/p/shellinabox/1315785_orig_hudca17843baf6397cc566da5ede5721bb_100680_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key=shellinabox data-hash="md5-GOA/Kcd9fjsrqwwlgO5Q6w=="></div><div class=article-details><h2 class=article-title>ShellinaBox 웹에서 즐기는 터미널</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"wanhae"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><footer class=site-footer><section class=copyright>&copy; 2022 iWan</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=1.0.5>Stack</a></b> designed by
<a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true style=display:none><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script><link rel=stylesheet href=/css/highlight/light.min.css media="(prefers-color-scheme: light)"><link rel=stylesheet href=/css/highlight/dark.min.css media="(prefers-color-scheme: dark)"></body></html>