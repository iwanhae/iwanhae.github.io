<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="구 블로그에서 가져옴"><title>nginx 개인서버에 HTTPS(TLS/SSL) 적용하기 (CA 없이)</title><link rel=canonical href=https://iwanhae.github.io/p/nginx-ssl-https/><link rel=stylesheet href=/scss/style.min.css><meta name=google-site-verification content="hueaQ_HMu3Eq1ONg2Nh47uVN-tQXPzXlh1DXig6eT7c"><meta property="og:title" content="nginx 개인서버에 HTTPS(TLS/SSL) 적용하기 (CA 없이)"><meta property="og:description" content="구 블로그에서 가져옴"><meta property="og:url" content="https://iwanhae.github.io/p/nginx-ssl-https/"><meta property="og:site_name" content="iWan"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:published_time" content="2016-09-21T00:00:00+00:00"><meta property="article:modified_time" content="2016-09-21T00:00:00+00:00"><meta property="og:image" content="https://iwanhae.github.io/p/nginx-ssl-https/--.PNG"><meta name=twitter:title content="nginx 개인서버에 HTTPS(TLS/SSL) 적용하기 (CA 없이)"><meta name=twitter:description content="구 블로그에서 가져옴"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://iwanhae.github.io/p/nginx-ssl-https/--.PNG"></head><body><div class="container flex on-phone--column align-items--flex-start extended article-page with-toolbar"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hub2a4b6b69d3b0618960cb9af6c0975e0_643282_300x300_resize_box_2.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>😎️</span></figure><h1 class=site-name><a href=https://iwanhae.github.io>iWan</a></h1><h2 class=site-description>#include "Hi.h"</h2></header><ol class=menu id=main-menu><li><a href=https://iwanhae.github.io/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=https://iwanhae.github.io/welcome-to-iwan><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=https://iwanhae.github.io/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li></ol></aside><main class="main full-width"><div id=article-toolbar><a href=https://iwanhae.github.io class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><article class="has-image main-article"><header class=article-header><div class=article-image><img srcset="/p/nginx-ssl-https/--_hu001d79d79eeba25fad427000cfd33131_13530_1024x0_resize_box_2.PNG 1024w, /p/nginx-ssl-https/--_hu001d79d79eeba25fad427000cfd33131_13530_2000x0_resize_box_2.PNG 2000w" src=/p/nginx-ssl-https/--_hu001d79d79eeba25fad427000cfd33131_13530_2000x0_resize_box_2.PNG width=599 height=238 loading=lazy alt="Featured image of post nginx 개인서버에 HTTPS(TLS/SSL) 적용하기 (CA 없이)"></div><div class=article-details><header class=article-category><a href=https://iwanhae.github.io/categories/server/ class=color-tag data-image=/p/nginx-ssl-https/--_hu001d79d79eeba25fad427000cfd33131_13530_20x20_fill_box_smart1_2.PNG data-key=nginx-ssl-https data-hash="md5-b/NSrXbAiPoAZPQ5MhJxpw==">Server</a></header><h2 class=article-title><a href=https://iwanhae.github.io/p/nginx-ssl-https/>nginx 개인서버에 HTTPS(TLS/SSL) 적용하기 (CA 없이)</a></h2><h3 class=article-subtitle>구 블로그에서 가져옴</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>2016년 09월 21일</time></footer></div></header><section class=article-content><h2 id=서론>서론</h2><p>필자가 다니는 학교 wifi는 교내라면 어디서든 심지어 야외에서도 빵빵하게 터지는 엄청난 장점과 함께 크나큰 단점이 한가지 있는데&mldr;..</p><p>라우터에서 http 통신내역을 까봐서 이것이 윈도우이면 보안을 위해 특정 프로그램을 설치하라는 홈페이지로 <strong>강제</strong> 리다이렉트 시킨다는 점이다.</p><p>물론 &ldquo;그냥 깔면 되는거 아니에요?&rdquo; 하겠지만&mldr;.. 이놈이 윈도 XP용으로 맞춰 만들어져 있어서 윈도 7, 8.1, 10에서는 깔기만해도 블루스크린으로 만들어주는 아주 대단한 놈이다.</p><p>이에대한 대응으로 VPN을 쓴다던가 우분투를 쓴다던가 크롬을 개조해서 http요청헤더에서 윈도부분만 쏙 빼는 별 여러가지 방법을 써봤지만 뭔가 느려지기도 하고 일일히 설정하는게 귀찮아지기도 하고 윈도가 편하고&mldr;.<del>(리눅스는 터미널로만 조작하는 스타일이다.)</del> 등의 이유로 별로 잘 사용하지 않게되었다.</p><p>그러다가 https는 요청헤더가 라우터에 까발려지지도 않아서 https로 제작된 사이트는~~(나X위키라던가 구X라던가 B잉 같은)~~ 자유롭게 접속 가능하다는 점을 알게 됬는데 학교에서 본인 http서버를 자유롭게 접속하기위해 본인의 서버를 https로 구성해본 경험을 적어보려 한다. ~~(사실 git서버 http통신으로 push하는데 이거때문에 해봤다는건 안비밀)~~</p><p>https에 대한 설명은
<a href=https://namu.wiki/w/TLS>https://namu.wiki/w/TLS</a>
<a href=https://opentutorials.org/course/228/4894>https://opentutorials.org/course/228/4894</a>
요 두개를 읽어보면 대충 이해할수 있다 생각된다.</p><h2 id=1-인증서-만들기>1. 인증서 만들기</h2><p>일단 https를 구현하기위한 개인키(.key), 서면요청파일(.csr) 그리고 인증서파일(.crt)가 필요하다.</p><p>보통 이 3가지는 CA에서 발급해주는 것을 쓰는게 정석이지만 필자의 경우 암호화 과정이 필요한거지 유사 사이트로 속여지는것에 대한 대비를 하자는게 아니기에 OpenSSL을 통해 자체적으로 만들것이다.</p><p>OpenSSL은 apt던 yum 이던 기본적으로 제공해주는 프로그램이니 각자 알아서 설치해주시고</p><p>적당한 폴더에 들어가서</p><p><code>openssl req -new -newkey rsa:2048 -nodes -keyout 도메인이름.key -out 도메인이름.csr</code></p><p>를 입력하고 (도메인이름이라곤 했지만 사실 뭘 쓰던 큰 상관은 없다.)</p><pre><code>Generating a 2048 bit RSA private key
.............................+++
......................................................+++
writing new private key to '도메인이름.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:
Email Address []:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
</code></pre><p>질문에 맞게 답해주면 .key파일고 .csr파일이 생성된다. (참고로 개인용으로 쓸꺼면 진지하게 할 필요는 없다.)</p><p>그리고 나서</p><p><code>openssl x509 -req -days 365 -in 도메인이름.csr -signkey 도메인이름.key -out 도메인이름.crt</code></p><p>명령어를 입력해주면 .crt 파일이 생성되는데 이를 통해 nginx에서 필요로 하는 파일은 .crt파일과 .key파일이 완성되었다.</p><blockquote><p>참고로
crt파일은 <code>openssl x509 -in *.crt -noout -text</code>
csr파일은 <code>openssl req -in *.csr -noout -text</code>
명령어를 통해 그 내용을 볼 수 있다.</p></blockquote><h2 id=2-nginx에서-써먹기>2. nginx에서 써먹기</h2><p>수정해야할 파일은 <code>/etc/nginx/sites-enabled</code> 폴더속에 있는 아무 파일이다. 보통 default파일이 기본적으로 있으니 이걸 수정한다 가정하고 필요한 것은</p><pre><code>    listen 443;

    ssl on;
    ssl_certificate /etc/SomeWhere/iwanhae.ga.crt; //crt경로
    ssl_certificate_key     /etc/SomeWhere/iwanhae.ga.key; //key경로

    //key는 유출되면 암호화가 무의미해지므로 보안을 철저히 해야한다.
</code></pre><p>이 4줄을 추가해 주는 것이다.</p><p>완성형으로 표현하면 대충 이런꼴이다.</p><pre><code>server {

    listen 443;

    ssl on;
    ssl_certificate /etc/SomeWhere/iwanhae.ga.crt;
    ssl_certificate_key     /etc/SomeWhere/iwanhae.ga.key;

    server_name blog.iwanhae.ga;

    //...//
}
</code></pre><p>이렇게 해주면 하나의 server { &mldr; } 에 대해서 443 포트에서 ssl이 적용된다.
다만 이럴경우 80번 포트는 열린적이 없어지게 되므로 기존 주소로 접근시에는 접속 거부가 뜨게된다.</p><pre><code>server{
        server_name blog.iwanhae.ga;
        rewrite ^ https://$server_name$request_uri? permanent;
}
</code></pre><p>이런식으로 새로운 server { &mldr; } 를 만들어 자동으로 redirect 시키는걸 추천하지만&mldr;..</p><p><img src=./--.PNG alt></p><p>CA에서 발급되지 않은 인증서를 쓰므로 다음과 같은 경고장이 날아오게 된다.</p><p>개인적 용도라면 별 상관없지만 공적인 용도라면 이 블로그처럼 http, https 모두 지원하게 설정해 놓는걸 추천한다.</p><p><a href=http://blog.iwanhae.ga>http://blog.iwanhae.ga</a>
<a href=https://blog.iwanhae.ga>https://blog.iwanhae.ga</a></p><h2 id=덤>덤</h2><p><code>git clone</code>하면 보안문제때문에 clone이 안된다.
<code>git -c http.sslVerify=false clone</code>을 통해 강제로 할수 있으니 참고하자.</p><h2 id=마무리>마무리</h2><p>https는 비록 심심풀이로 한 일이지만 꽤 괜찮다. 뭔가 암호화 됬다는 느낌과 함께 각종 라우터의 탐색은 모두 무시되고 <del>(kt의 컴퓨터 대수제한이라던가 warning.or.kr이라던가&mldr;)</del> 별로 기대하지 않았는데 OwnCloud에서 보안설정하라는 메세지도 안뜬다!!!</p><p>는 농담이고 일반적으로 이윤을 추구하지 않는 사이트 운영자는 아마 https를 별로 쓸일은 없을것이다. (있다면 부디 댓글로 남겨주길 바란다. 순수한 호기심이다.)</p><p>하지만 적어도 본인은 학교에서 자유롭게 본인 사이트에 접속할 수 있게되었고 웹페이지 기반 ssh, git서버, IDE, phpmyadmin~~, 영화사이트~~를 학교 와이파이로 만지작만지작 거릴수 있게되어 솔직하게 기쁘다.</p><p>궁금한점 있으면 댓글로 남겨주면 가능한 범위내에서 답변은 해주겠지만 본인도 새로운 분야이기에 가능하면 자문자답을 댓글로 해줬으면 하는 바람이다.</p><h2 id=2020년에-적는-코멘트>2020년에 적는 코멘트</h2><p>Google이 밀어준다고 https가 이렇게 활성화 될 줄 누가 알았겠어요? ㄷㄷ;;;</p><p>그당시에도 Let&rsquo;s encrypt가 존재는 했었지만 그떄는 별로 인기가 없었고 https는 개인서버 운영자에게는 단순히 귀찮을 존재였을 뿐입니다.</p><p>지금은 안쓰면 검색노출도 안되는 기본적인 존재이지만요. 본 서버는 아마 바뀔지도 모르지만 기본적으로 Kubernetes + ingress nginx 환경에서 http<strong>s</strong>로 제공됩니다.</p></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload="renderMathInElement(document.querySelector(`.article-content`));"></script></article><aside class="widget related-contents--wrapper"><h1 class=widget-title></h1><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=https://iwanhae.github.io/p/disabling_uas_on_linux/><div class=article-image><img src=/p/disabling_uas_on_linux/5700219_2_hud52212587ef5e2c8c5bb794242b75122_10725_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy data-key=disabling_uas_on_linux data-hash="md5-r4H8r7HtiIGX0oIWzgDLPw=="></div><div class=article-details><h2 class=article-title>Odroid N2, Linux에서 UAS 비활성화</h2></div></a></article><article class=has-image><a href=https://iwanhae.github.io/p/config-netplan-bridge/><div class=article-image><img src=/p/config-netplan-bridge/netplan_hu64e3fbf4fa724c9fadaeb8a9cb4d85df_56060_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key=config-netplan-bridge data-hash="md5-ABxmSxxb4eJwr+EYPCBD0w=="></div><div class=article-details><h2 class=article-title>Netplan Bridge 구성기</h2></div></a></article><article class=has-image><a href=https://iwanhae.github.io/p/renewing_freenom_domain/><div class=article-image><img src=/p/renewing_freenom_domain/1_hu4676b6a3ff35eaeac3cf791939cc3722_949805_250x150_fill_box_smart1_2.PNG width=250 height=150 loading=lazy data-key=renewing_freenom_domain data-hash="md5-7ZxOVLCu21fJCBAM/o/Q0w=="></div><div class=article-details><h2 class=article-title>Freenom 도메인 갱신하는법</h2></div></a></article><article class=has-image><a href=https://iwanhae.github.io/p/saga_of_wanhae_the_googler/><div class=article-image><img src=/p/saga_of_wanhae_the_googler/1_hu41572d6144ff73f80dd14306a597fd99_32390_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key=saga_of_wanhae_the_googler data-hash="md5-TQ+TXrYq1o9bVX2sdT4MyA=="></div><div class=article-details><h2 class=article-title>사이버 지식 정보방 (사지방) 구글 접속기</h2></div></a></article><article class=has-image><a href=https://iwanhae.github.io/p/shellinabox/><div class=article-image><img src=/p/shellinabox/1315785_orig_hudca17843baf6397cc566da5ede5721bb_100680_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key=shellinabox data-hash="md5-GOA/Kcd9fjsrqwwlgO5Q6w=="></div><div class=article-details><h2 class=article-title>ShellinaBox 웹에서 즐기는 터미널</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"wanhae"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><footer class=site-footer><section class=copyright>&copy; 2021 iWan</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=1.0.5>Stack</a></b> designed by
<a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true style=display:none><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script><link rel=stylesheet href=/css/highlight/light.min.css media="(prefers-color-scheme: light)"><link rel=stylesheet href=/css/highlight/dark.min.css media="(prefers-color-scheme: dark)"></body></html>